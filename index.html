<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Love Coin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:white;
  display:flex;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
}

.page{
  flex:1;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  position:relative;
  padding-bottom:60px;
}

.active{
  display:flex;
}

/* کمی بالاتر رفتن سکه و عدد */
.counter{
  font-size:34px;
  font-weight:bold;
  margin-bottom:40px;
  margin-top:-40px;
}

.coinImg{
  width:240px;
  height:240px;
  object-fit:contain;
  cursor:pointer;
  transition:transform 0.15s;
  filter: drop-shadow(0 0 30px gold);
  user-select:none;
  -webkit-user-drag:none;
  -webkit-tap-highlight-color: transparent;
}

/* +1 بلندتر بره بالا */
.plusOne {
  position:absolute;
  color:gold;
  font-weight:bold;
  font-size:26px;
  animation: floatUp 1.2s forwards;
  pointer-events:none;
}

@keyframes floatUp {
  0% { opacity:1; transform: translateY(0); }
  100% { opacity:0; transform: translateY(-120px); }
}

.energyBox{
  width:220px;
  height:12px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  position:absolute;
  bottom:90px;
}

.energyFill{
  height:100%;
  width:100%;
  background:linear-gradient(90deg, gold, orange);
  transition:width 0.2s;
}

.energyText{
  font-size:14px;
  color:#aaa;
  position:absolute;
  bottom:70px;
  text-align:center;
  width:100%;
}

.navbar{
  height:70px;
  background:#181818;
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top:1px solid #333;
}

.navbtn{
  color:#888;
  font-size:14px;
  cursor:pointer;
}

.navbtn.active{
  color:gold;
  font-weight:bold;
}
</style>
</head>

<body>

<div id="home" class="page active">
  <div class="counter"><span id="count">0</span></div>

  <img id="loveCoinImg"
       src="https://cdn.imgurl.ir/uploads/p719635__.png"
       class="coinImg">

  <div class="energyBox">
    <div id="energyFill" class="energyFill"></div>
  </div>
  <div class="energyText">
    Energy: <span id="energyText">100</span> / 100
  </div>
</div>

<div class="navbar">
  <div class="navbtn active">Home</div>
</div>

<script>
let count = parseInt(localStorage.getItem("loveCoin")) || 0;
let energy = parseInt(localStorage.getItem("energy")) || 100;
const maxEnergy = 100;

const countEl = document.getElementById("count");
const energyText = document.getElementById("energyText");
const energyFill = document.getElementById("energyFill");
const coinImg = document.getElementById("loveCoinImg");

updateUI();

function formatNumber(num){
  if(num >= 1_000_000_000) return (num/1_000_000_000).toFixed(2)+"B";
  if(num >= 1_000_000) return (num/1_000_000).toFixed(2)+"M";
  if(num >= 1_000) return (num/1_000).toFixed(2)+"K";
  return num;
}

function updateUI(){
  countEl.innerText = formatNumber(count);
  energyText.innerText = energy;
  energyFill.style.width = (energy / maxEnergy * 100) + "%";
  localStorage.setItem("loveCoin", count);
  localStorage.setItem("energy", energy);
}

function addCoin(x,y){
  if(energy <= 0) return;

  count++;
  energy--;

  // تکون خوردن سکه بر اساس جهت ضربه
  const rect = coinImg.getBoundingClientRect();
  const centerX = rect.left + rect.width/2;
  const centerY = rect.top + rect.height/2;

  const offsetX = (x - centerX) / 8;
  const offsetY = (y - centerY) / 8;

  coinImg.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(0.95)`;
  setTimeout(()=>{
    coinImg.style.transform = "translate(0,0) scale(1)";
  },120);

  const plus=document.createElement("div");
  plus.innerText="+1";
  plus.classList.add("plusOne");
  plus.style.left = x + "px";
  plus.style.top = y + "px";
  document.getElementById("home").appendChild(plus);
  setTimeout(()=>plus.remove(),1200);

  updateUI();
}

let touchUsed = false;

coinImg.addEventListener("touchstart", (e)=>{
  e.preventDefault();
  touchUsed = true;

  for(let i=0;i<e.changedTouches.length;i++){
    const t = e.changedTouches[i];
    addCoin(t.clientX, t.clientY);
  }

  setTimeout(()=> touchUsed = false, 50);
});

coinImg.addEventListener("click", (e)=>{
  if(touchUsed) return;
  addCoin(e.clientX, e.clientY);
});

setInterval(()=>{
  if(energy < maxEnergy){
    energy++;
    updateUI();
  }
},1000);

</script>
</body>
</html>
