<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Love Coin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:white;
  display:flex;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
}

/* ØµÙØ­Ù‡ Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
#loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.5s ease;
}

.loader-coins {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.mini-coin {
  width: 40px;
  height: 40px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  from { transform: rotateY(0deg); }
  to { transform: rotateY(360deg); }
}

.loading-text {
  color: gold;
  letter-spacing: 2px;
  font-size: 14px;
}

/* Ø§Ø³ØªØ§ÛŒÙ„ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ */
.page{
  flex:1;
  display:none; /* Ø§Ø¨ØªØ¯Ø§ Ù…Ø®ÙÛŒ */
  justify-content:flex-start;
  transform: translateY(20px); /* Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ØªØ±*/
  align-items:center;
  flex-direction:column;
  position:relative;
  padding-top:40px;
  padding-bottom:120px;
}

.active{
  display:flex;
}

.counter{
  font-size:38px; /* Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯ØªØ± */
  font-weight:bold;
  margin-top:10px;
  margin-bottom:40px;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  transform: translateY(-3px); /* Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ØªØ± */
}

.coinImg{
  width:260px; /* Ú©Ù…ÛŒ Ø¨Ø²Ø±Ú¯ØªØ± */
  height:260px;
  object-fit:contain;
  cursor:pointer;
  will-change: transform;
  transition:transform 0.1s;
  filter: drop-shadow(0 0 40px gold);
  user-select:none;
  -webkit-user-drag:none;
  -webkit-tap-highlight-color: transparent;
}

.plusOne {
  position:absolute;
  color:gold;
  font-weight:bold;
  font-size:28px;
  animation: floatUp 1s forwards;
  pointer-events:none;
}

@keyframes floatUp {
  0% { opacity:1; transform: translateY(0); }
  100% { opacity:0; transform: translateY(-150px); }
}

.energyFill{
  height:100%;
  width:100%;
  background:linear-gradient(90deg, gold, orange);
  transition:width 0.2s;
}

.energyBox{
  width:220px;
  height:12px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin-top:15px;
}

.energyText{
  font-size:14px;
  color:#aaa;
  margin-top:5px;
  text-align:center;
}
  
.navbar{
  height:70px;
  background:#181818;
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top:1px solid #333;
}

.navbtn{
  color:#888;
  font-size:14px;
  cursor:pointer;
}

.navbtn.active{
  color:gold;
  font-weight:bold;
}

.setting-row{
  width:85%;
  max-width:400px;
  background:#181818;
  padding:15px 20px;
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
  border:1px solid #333;
}

.setting-row span{
  font-size:15px;
}

.setting-row button{
  background: linear-gradient(90deg, gold, orange);
  border:none;
  padding:8px 14px;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  transition:0.2s;
}

.setting-row button:hover{
  transform:scale(1.05);
  box-shadow:0 0 10px gold;
}
  
.toggle{
  width:55px;
  height:28px;
  background:#444;
  border-radius:20px;
  position:relative;
  cursor:pointer;
  transition:0.3s;
}

.toggle::after{
  content:"";
  position:absolute;
  width:22px;
  height:22px;
  background:#aaa;
  border-radius:50%;
  top:3px;
  left:4px;
  transition:0.3s;
}

.toggle.active{
  background:gold;
}

.toggle.active::after{
  left:29px;
  background:#111;
}
  
</style>
</head>

<body>

<!-- ØµÙØ­Ù‡ Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
<div id="loading-screen">
  <div class="loader-coins">
    <img src="https://cdn.imgurl.ir/uploads/p719635__.png" class="mini-coin">
  </div>
  <div class="loading-text">LOADING...</div>
</div>

<div id="home" class="page">

  <div class="counter"><span id="count">0</span></div>

  <img id="loveCoinImg"
       src="https://cdn.imgurl.ir/uploads/p719635__.png"
       class="coinImg">

  <!-- ENERGY -->
  <div class="energyBox">
    <div id="energyFill" class="energyFill"></div>
  </div>
  <div class="energyText">
    Energy: <span id="energyText">100</span> / 100
  </div>

  <!-- XP -->
  <div class="energyBox">
    <div id="xpFill" class="energyFill"
         style="background:linear-gradient(90deg,#00f0ff,#00ff88);">
    </div>
  </div>
  <div class="energyText">
    Level <span id="levelText">1</span> â€¢
    XP: <span id="xpText">0</span> /
    <span id="xpNeedText">50</span>
  </div>

  <!-- COMBO -->
  <div class="energyBox">
    <div id="comboFill" class="energyFill"
         style="background:linear-gradient(90deg,#ff00cc,#ff6600); width:0%;">
    </div>
  </div>
  <div class="energyText">
    Combo: <span id="comboText">x1</span>
  </div>

</div>

<div id="shop" class="page">
  <h2>Shop</h2>

  <div class="setting-row">
    <span>
      <b>Tap Power</b><br>
      Lv <span id="tapLv">1</span><br>
      Cost: <span id="tapCost">0</span>
    </span>
    <button onclick="upgradeTap()">Upgrade</button>
  </div>

  <div class="setting-row">
    <span>
      <b>Max Energy</b><br>
      Lv <span id="energyLv">0</span><br>
      Cost: <span id="energyCost">0</span>
    </span>
    <button onclick="upgradeEnergy()">Upgrade</button>
  </div>

  <div class="setting-row">
    <span>
      <b>Recharging Speed</b><br>
      Lv <span id="rechargeLv">1</span><br>
      Cost: <span id="rechargeCost">0</span>
    </span>
    <button onclick="upgradeRecharge()">Upgrade</button>
  </div>
  
  <div class="setting-row">
    <span>
      <b>Auto Clicker</b><br>
      Lv <span id="autoLv">0</span><br>
      Cost: <span id="autoCost">0</span>
    </span>
    <button onclick="upgradeAuto()">Upgrade</button>
  </div>

</div>
  
<div id="profile" class="page">
  <h2>Profile</h2>
  <div class="setting-row">
    <span>
      <b>Daily Reward</b><br>
      Claim your daily coins!
    </span>
    <button onclick="claimDaily()">Claim</button>
  </div>
</div>

<div id="settings" class="page">
  <h2 style="margin-bottom:25px;">Settings</h2>

  <div class="setting-row">
    <span>Vibration</span>
    <div class="toggle" data-setting="vibration"></div>
  </div>

  <div class="setting-row">
    <span>Sound Effects</span>
    <div class="toggle" data-setting="sound"></div>
  </div>

  <div class="setting-row">
    <span>Floating +1</span>
    <div class="toggle" data-setting="floatingText"></div>
  </div>
</div>

<div id="levelUpPopup" style="
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%) scale(0.8);
background:linear-gradient(135deg,#111,#222);
padding:25px 35px;
border-radius:20px;
border:2px solid gold;
box-shadow:0 0 30px gold;
color:gold;
font-size:28px;
font-weight:bold;
opacity:0;
pointer-events:none;
transition:0.3s;
z-index:9999;
text-align:center;
">
  LEVEL UP<br>
  <span id="levelUpNumber"></span>
</div>

<div id="customAlert" style="
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%) scale(0.8);
background:#111;
padding:20px 40px;
border-radius:18px;
border:2px solid gold;
box-shadow:0 0 30px gold;
color:white;
font-size:18px;
opacity:0;
pointer-events:none;
transition:0.3s;
z-index:9999;
text-align:center;
max-width:85%;
">
  <div id="alertMessage"></div>
  <div style="margin-top:15px;">
    <button onclick="closeCustomAlert()" style="
      background:gold;
      border:none;
      padding:8px 18px;
      border-radius:8px;
      font-weight:bold;
      cursor:pointer;
    ">OK</button>
  </div>
</div>
  
<div class="navbar">
  <div class="navbtn active" onclick="showPage('home', this)">Home</div>
  <div class="navbtn" onclick="showPage('shop', this)">Shop</div>
  <div class="navbtn" onclick="showPage('profile', this)">Profile</div>
  <div class="navbtn" onclick="showPage('settings', this)">Settings</div>
</div>

<script>
// ===== SAFE LOAD GAME =====
function getDefaultGame(){
  return {
    coins: 0,
    energy: 100,
    maxEnergy: 100,
    tapLevel: 1,
    autoClickerLevel: 0,
    energyLevel: 0,
    rechargeLevel: 0,
    rechargeSpeed: 1,
    xp: 0,
    level: 1,
    xpNeed: 50
  };
}

let savedGame = JSON.parse(localStorage.getItem("loveCoinGame"));
let game = savedGame ? {...getDefaultGame(), ...savedGame} : getDefaultGame();
let lastClickTime = 0;
let comboMultiplier = 1;
let autoActiveUntil = 0;
let comboValue = 0;
let comboMax = 100;
let comboTimeout;
  
// Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² NaN
function fixNumbers(){
  for(let key in game){
    if(typeof game[key] !== "number" || isNaN(game[key])){
      game[key] = getDefaultGame()[key];
    }
  }
}
fixNumbers();


// ===== SETTINGS SYSTEM =====
let settings = JSON.parse(localStorage.getItem("loveCoinSettings")) || {
  vibration: true,
  sound: true,
  floatingText: true
};

document.querySelectorAll(".toggle").forEach(toggle=>{
  const key = toggle.dataset.setting;

  if(settings[key]){
    toggle.classList.add("active");
  }

  toggle.addEventListener("click", ()=>{
    settings[key] = !settings[key];
    toggle.classList.toggle("active");

    localStorage.setItem("loveCoinSettings", JSON.stringify(settings));
  });
});

  
// ===== LOADING FIX =====
window.addEventListener('load', () => {
  const loader = document.getElementById('loading-screen');
  const home = document.getElementById('home');

  setTimeout(()=>{
    loader.style.opacity = '0';
    setTimeout(() => {
      loader.style.display = 'none';
      home.classList.add('active');
    }, 500);
  },3500); // â† Ø²Ù…Ø§Ù† Ø¯Ù„Ø®ÙˆØ§Ù‡
});


// ===== ELEMENTS =====
const countEl = document.getElementById("count");
const energyText = document.getElementById("energyText");
const energyFill = document.getElementById("energyFill");
const coinImg = document.getElementById("loveCoinImg");
const xpFill = document.getElementById("xpFill");
const xpText = document.getElementById("xpText");
const xpNeedText = document.getElementById("xpNeedText");
const levelText = document.getElementById("levelText");
const clickSound = new Audio('https://uploadkon.ir/uploads/d14f25_26374coin-jingle-6996422-1.mp3'); 
  

// ===== FORMAT NUMBER SAFE =====
function formatNumber(num){
  if(isNaN(num)) return 0;
  if(num >= 1e9) return (num/1e9).toFixed(2)+"B";
  if(num >= 1e6) return (num/1e6).toFixed(2)+"M";
  if(num >= 1e3) return (num/1e3).toFixed(2)+"K";
  return Math.floor(num);
}


// ===== UPDATE UI SAFE =====
function updateUI(){
  fixNumbers();

  countEl.innerText = formatNumber(game.coins);

  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù‚Ø¯Ø§Ø± maxEnergy
  game.energy = Math.max(0, Math.min(game.energy, game.maxEnergy));  // Ù…Ø·Ù…Ø¦Ù† Ø¨Ø´ÛŒÙ… Ú©Ù‡ energy Ø¨ÛŒØ´ØªØ± Ø§Ø² maxEnergy Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
  energyText.innerText = Math.floor(game.energy) + " / " + game.maxEnergy;  // Ø­ØªÙ…Ø§ maxEnergy Ø±Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
  energyFill.style.width = (game.energy / game.maxEnergy * 100) + "%";

  xpText.innerText = Math.floor(game.xp);
  xpNeedText.innerText = game.xpNeed;
  levelText.innerText = game.level;
  xpFill.style.width = (game.xp / game.xpNeed * 100) + "%";

  // ===== SHOP UI =====
  document.getElementById("tapLv").innerText = game.tapLevel;
  document.getElementById("autoLv").innerText = game.autoClickerLevel;
  document.getElementById("energyLv").innerText = game.energyLevel;
  document.getElementById("rechargeLv").innerText = game.rechargeLevel;

  let tapCost = Math.floor(250 * Math.pow(1.6, game.tapLevel - 1));
  let autoCost = Math.floor(100000 * Math.pow(1.7, game.autoClickerLevel));
  let energyCost = Math.floor(500 * Math.pow(1.5, game.energyLevel));
  let rechargeCost = Math.floor(10000 * Math.pow(1.7, game.rechargeLevel));

  document.getElementById("tapCost").innerText = formatNumber(tapCost);
  document.getElementById("autoCost").innerText = formatNumber(autoCost);
  document.getElementById("energyCost").innerText = formatNumber(energyCost);
  document.getElementById("rechargeCost").innerText = formatNumber(rechargeCost);
}


// ===== ENERGY REGEN SAFE =====
let lastTime = parseInt(localStorage.getItem("lastEnergyTime")) || Date.now();
let now = Date.now();
let diff = Math.floor((now - lastTime) / 1000);

game.energy = Math.min(game.maxEnergy, game.energy + diff);
localStorage.setItem("lastEnergyTime", Date.now());

setInterval(()=>{
  if(game.energy < game.maxEnergy){
    game.energy += game.rechargeSpeed;
    updateUI();
  }
},1000);


// ===== AUTO CLICK SAFE =====
setInterval(()=>{
  if(game.autoClickerLevel > 0 && Date.now() < autoActiveUntil){
    game.coins += game.autoClickerLevel;
    updateUI();
  }
},1000);


// ===== ADD XP SAFE =====
function addXP(amount){
  game.xp += amount;

  while(game.xp >= game.xpNeed){
    game.xp -= game.xpNeed;
    game.level++;
    game.xpNeed = Math.floor(game.xpNeed * 1.5);
    game.coins += game.level * 10;
    showLevelUp();
  }
}


// ===== CLICK SYSTEM SAFE =====
function addCoin(x,y){
  if(game.energy <= 0) return;

  let nowClick = Date.now();
  let diffClick = nowClick - lastClickTime;

  if(diffClick < 3.9){
  comboMultiplier = 2;
}
  else if(diffClick < 4.2){
  comboMultiplier = 1.5;
}
  else if(diffClick < 4.7){
  comboMultiplier = 1.2;
}
  else{
  comboMultiplier = 1;
}

  lastClickTime = nowClick;

  // Ø§ÙØ²Ø§ÛŒØ´ Ù…Ù‚Ø¯Ø§Ø± Ú©Ù…Ø¨Ùˆ
  comboValue += 15;

  if(comboValue > comboMax){
  comboValue = comboMax;
}

  // Ø§Ú¯Ø± Ú©Ù…Ø¨Ùˆ Ú©Ø§Ù…Ù„ Ø´Ø¯ â†’ Ø¶Ø±Ø¨ 2
  if(comboValue >= comboMax){
  comboMultiplier = 2;
}

  // Ø±ÛŒØ³Øª ØªØ§ÛŒÙ…Ø± Ú©Ù…Ø¨Ùˆ
  clearTimeout(comboTimeout);
  comboTimeout = setTimeout(()=>{
  comboValue = 0;
  comboMultiplier = 1;
  updateComboUI();
},1000); // Ø§Ú¯Ø± 1 Ø«Ø§Ù†ÛŒÙ‡ Ú©Ù„ÛŒÚ© Ù†Ú©Ù†Ù‡ Ø±ÛŒØ³Øª Ù…ÛŒØ´Ù‡

  updateComboUI();
  
  game.coins += game.tapLevel * comboMultiplier;
  if(game.energy < game.tapLevel) return;
  game.energy -= game.tapLevel;
  addXP(1);

  // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¶Ø±Ø¨Ù‡
  const rect = coinImg.getBoundingClientRect();
  const centerX = rect.left + rect.width/2;
  const centerY = rect.top + rect.height/2;

  const offsetX = (x - centerX) / 8;
  const offsetY = (y - centerY) / 8;

  coinImg.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(0.95)`;
  setTimeout(()=>{
  coinImg.style.transform = "translate(0,0) scale(1)";
},120);
  
  // Floating text
  if(settings.floatingText){
  const plus = document.createElement("div");
  plus.innerText = "+" + game.tapLevel;
  plus.className = "plusOne";
  plus.style.left = (x - 10) + "px";
  plus.style.top = (y - 20) + "px";
  document.getElementById("home").appendChild(plus);
  setTimeout(()=>plus.remove(),1000);

  plus.innerText = "+" + Math.floor(game.tapLevel * comboMultiplier);

  if(comboMultiplier > 1){
  plus.style.color = "#00f0ff";
}
}

  // Navigator
  if (settings.vibration === true && navigator.vibrate) {
    navigator.vibrate(20); // Ù…Ù‚Ø¯Ø§Ø± 20 Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡
  }

  // ClickSound
  if (settings.sound === true && typeof clickSound !== 'undefined') {
    clickSound.currentTime = 0; // ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ Ø±Ø§ Ø¨Ù‡ Ø§Ø¨ØªØ¯Ø§ÛŒ Ø¢Ù† Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
    clickSound.play();
  }
  
  updateUI();
}

let touchUsed = false;

// Ù„Ù…Ø³ Ú†Ù†Ø¯ Ø§Ù†Ú¯Ø´ØªÛŒ
coinImg.addEventListener("touchstart", (e)=>{
  e.preventDefault();
  touchUsed = true;

  for(let i=0;i<e.changedTouches.length;i++){
    const t = e.changedTouches[i];
    addCoin(t.clientX, t.clientY);
  }

  setTimeout(()=> touchUsed = false, 50);
});

// Ú©Ù„ÛŒÚ© Ù…Ø¹Ù…ÙˆÙ„ÛŒ (Ø¨Ø±Ø§ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾)
coinImg.addEventListener("click", (e)=>{
  if(touchUsed) return;
  addCoin(e.clientX, e.clientY);
});


function updateComboUI(){
  const comboFill = document.getElementById("comboFill");
  const comboText = document.getElementById("comboText");

  comboFill.style.width = (comboValue / comboMax * 100) + "%";
  comboText.innerText = "x" + comboMultiplier;

  if(comboMultiplier > 1){
    comboFill.style.boxShadow = "0 0 15px #ff00cc";
  }else{
    comboFill.style.boxShadow = "none";
  }
}
  

// ===== SHOP SAFE =====
function upgradeTap(){
  let cost = Math.floor(250 * Math.pow(1.6, game.tapLevel - 1));
  if(game.coins >= cost){
    game.coins -= cost;
    game.tapLevel++;
    updateUI();
  }
}
  
function upgradeEnergy(){
  let cost = Math.floor(500 * Math.pow(1.5, game.energyLevel));
  if(game.coins >= cost){
    game.coins -= cost;
    game.energyLevel++;
    game.maxEnergy = 100 + (game.energyLevel * 20);
    updateUI();
  }
}

function upgradeRecharge(){
  let cost = Math.floor(10000 * Math.pow(1.7, game.rechargeLevel));
  if(game.coins >= cost){
    game.coins -= cost;
    game.rechargeLevel++;
    game.rechargeSpeed = 1 + game.rechargeLevel * 0.1;  // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª Ø´Ø§Ø±Ú˜ Ø§Ù†Ø±Ú˜ÛŒ
    updateUI();
  }
}
  
function upgradeAuto(){
  let cost = Math.floor(100000 * Math.pow(1.7, game.autoClickerLevel));

  if(game.coins >= cost){
    game.coins -= cost;
    game.autoClickerLevel++;

    autoActiveUntil = Date.now() + (5 * 60 * 1000); // 5 Ø¯Ù‚ÛŒÙ‚Ù‡ ÙØ¹Ø§Ù„

    updateUI();
  }
  }
  

// ===== PAGE SYSTEM =====
function showPage(pageId, btn){
  document.querySelectorAll(".page").forEach(p=>{
    p.classList.remove("active");
  });

  document.querySelectorAll(".navbtn").forEach(b=>{
    b.classList.remove("active");
  });

  document.getElementById(pageId).classList.add("active");
  btn.classList.add("active");
}

function showLevelUp(){
  const popup = document.getElementById("levelUpPopup");
  const number = document.getElementById("levelUpNumber");

  number.innerText = "Level " + game.level;

  popup.style.opacity = "1";
  popup.style.transform = "translate(-50%,-50%) scale(1)";

  setTimeout(()=>{
    popup.style.opacity = "0";
    popup.style.transform = "translate(-50%,-50%) scale(0.8)";
  },3100);
}

function showCustomAlert(message){
  const alertBox = document.getElementById("customAlert");
  const alertMsg = document.getElementById("alertMessage");

  alertMsg.innerText = message;

  alertBox.style.opacity = "1";
  alertBox.style.pointerEvents = "auto";
  alertBox.style.transform = "translate(-50%,-50%) scale(1)";
}

function closeCustomAlert(){
  const alertBox = document.getElementById("customAlert");
  alertBox.style.opacity = "0";
  alertBox.style.pointerEvents = "none";
  alertBox.style.transform = "translate(-50%,-50%) scale(0.8)";
  }
  

function claimDaily(){
  let lastClaim = localStorage.getItem("dailyRewardTime");
  let now = Date.now();

  if(!lastClaim || now - lastClaim > 86400000){
    let reward = 500 + (game.level * 50);
    game.coins += reward;
    localStorage.setItem("dailyRewardTime", now);
    showCustomAlert("ğŸ You received " + reward + " coins!");
    updateUI();
  }else{
    showCustomAlert("â³ Come back tomorrow!");
  }
}
  
  
// ===== SAVE SAFE =====
setInterval(()=>{
  fixNumbers();
  localStorage.setItem("loveCoinGame", JSON.stringify(game));
  localStorage.setItem("lastEnergyTime", Date.now());
},3000);

updateUI();
</script>
</body>
</html>
