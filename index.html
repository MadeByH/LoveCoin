<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Love Coin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:white;
  display:flex;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
}

/* صفحه لودینگ */
#loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.5s ease;
}

.loader-coins {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.mini-coin {
  width: 40px;
  height: 40px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  from { transform: rotateY(0deg); }
  to { transform: rotateY(360deg); }
}

.loading-text {
  color: gold;
  letter-spacing: 2px;
  font-size: 14px;
}

/* استایل صفحه اصلی */
.page{
  flex:1;
  display:none; /* ابتدا مخفی */
  justify-content:center;
  transform: translateY(20px); /* کمی بالاتر*/
  align-items:center;
  flex-direction:column;
  position:relative;
  padding-bottom:60px;
}

.active{
  display:flex;
}

.counter{
  font-size:38px; /* کمی بزرگتر */
  font-weight:bold;
  margin-bottom:30px;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.coinImg{
  width:260px; /* کمی بزرگتر */
  height:260px;
  object-fit:contain;
  cursor:pointer;
  will-change: transform;
  transition:transform 0.1s;
  filter: drop-shadow(0 0 40px gold);
  user-select:none;
  -webkit-user-drag:none;
  -webkit-tap-highlight-color: transparent;
}

.plusOne {
  position:absolute;
  color:gold;
  font-weight:bold;
  font-size:28px;
  animation: floatUp 1s forwards;
  pointer-events:none;
}

@keyframes floatUp {
  0% { opacity:1; transform: translateY(0); }
  100% { opacity:0; transform: translateY(-150px); }
}

.energyBox{
  width:220px;
  height:12px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  position:absolute;
  bottom:110px;
}

.energyFill{
  height:100%;
  width:100%;
  background:linear-gradient(90deg, gold, orange);
  transition:width 0.2s;
}

.energyText{
  font-size:14px;
  color:#aaa;
  position:absolute;
  bottom:90px;
  text-align:center;
  width:100%;
}

.navbar{
  height:70px;
  background:#181818;
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top:1px solid #333;
}

.navbtn{
  color:#888;
  font-size:14px;
  cursor:pointer;
}

.navbtn.active{
  color:gold;
  font-weight:bold;
}

.setting-row{
  width:85%;
  max-width:400px;
  background:#181818;
  padding:15px 20px;
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
  border:1px solid #333;
}

.setting-row span{
  font-size:15px;
}

.toggle{
  width:55px;
  height:28px;
  background:#444;
  border-radius:20px;
  position:relative;
  cursor:pointer;
  transition:0.3s;
}

.toggle::after{
  content:"";
  position:absolute;
  width:22px;
  height:22px;
  background:#aaa;
  border-radius:50%;
  top:3px;
  left:4px;
  transition:0.3s;
}

.toggle.active{
  background:gold;
}

.toggle.active::after{
  left:29px;
  background:#111;
}
  
</style>
</head>

<body>

<!-- صفحه لودینگ -->
<div id="loading-screen">
  <div class="loader-coins">
    <img src="https://cdn.imgurl.ir/uploads/p719635__.png" class="mini-coin">
  </div>
  <div class="loading-text">LOADING...</div>
</div>

<div id="home" class="page">
  <div class="counter"><span id="count">0</span></div>

  <img id="loveCoinImg"
       src="https://cdn.imgurl.ir/uploads/p719635__.png"
       class="coinImg">

  <div class="energyBox">
    <div id="energyFill" class="energyFill"></div>
  </div>
  <div class="energyText">
    Energy: <span id="energyText">100</span> / 100
  </div>
</div>

<div id="shop" class="page">
  <h2>Shop</h2>
  <p>Coming Soon...</p>
</div>
  
<div id="profile" class="page">
  <h2>Profile</h2>
  <p>Coming Soon...</p>
</div>

<div id="settings" class="page">
  <h2 style="margin-bottom:25px;">Settings</h2>

  <div class="setting-row">
    <span>Vibration</span>
    <div class="toggle" data-setting="vibration"></div>
  </div>

  <div class="setting-row">
    <span>Sound Effects</span>
    <div class="toggle" data-setting="sound"></div>
  </div>

  <div class="setting-row">
    <span>Floating +1</span>
    <div class="toggle" data-setting="floatingText"></div>
  </div>
</div>
  
<div class="navbar">
  <div class="navbtn active" onclick="showPage('home', this)">Home</div>
  <div class="navbtn" onclick="showPage('shop', this)">Shop</div>
  <div class="navbtn" onclick="showPage('profile', this)">Profile</div>
  <div class="navbtn" onclick="showPage('settings', this)">Settings</div>
</div>

<script>
// مدیریت لودینگ
window.addEventListener('load', () => {
  setTimeout(() => {
    const loader = document.getElementById('loading-screen');
    const home = document.getElementById('home');
    loader.style.opacity = '0';
    setTimeout(() => {
      loader.style.display = 'none';
      home.classList.add('active');
    }, 500);
  }, 3000); // ۳ ثانیه زمان لودینگ
});

let count = parseInt(localStorage.getItem("loveCoin")) || 0;
let energy = parseInt(localStorage.getItem("energy")) || 100;
const maxEnergy = 100;

const countEl = document.getElementById("count");
const energyText = document.getElementById("energyText");
const energyFill = document.getElementById("energyFill");
const coinImg = document.getElementById("loveCoinImg");
const clickSound = new Audio("https://uploadkon.ir/uploads/594524_26Video-۲۰۲۶۰۲۲۴۲۲۴۹۳۴۷۸۴-by-VideoShow.mp3");
  
updateUI();

function formatNumber(num){
  if(num >= 1_000_000_000) return (num/1_000_000_000).toFixed(2)+"B";
  if(num >= 1_000_000) return (num/1_000_000).toFixed(2)+"M";
  if(num >= 1_000) return (num/1_000).toFixed(2)+"K";
  return num;
}

function updateUI(){
  countEl.innerText = formatNumber(count);
  energyText.innerText = energy;
  energyFill.style.width = (energy / maxEnergy * 100) + "%";
  localStorage.setItem("loveCoin", count);
  localStorage.setItem("energy", energy);
}

function addCoin(x,y){
  if(energy <= 0) return;

  count++;
  energy--;

  const rect = coinImg.getBoundingClientRect();
  const centerX = rect.left + rect.width/2;
  const centerY = rect.top + rect.height/2;

  const offsetX = (x - centerX) / 8;
  const offsetY = (y - centerY) / 8;

  coinImg.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(0.95)`;
  setTimeout(()=>{
    coinImg.style.transform = "translate(0,0) scale(1)";
  },120);

  if(localStorage.getItem("setting_floatingText") !== "false"){
  const plus = document.createElement("div");
  plus.innerText = "+1";
  plus.classList.add("plusOne");
  plus.style.left = (x - 10) + "px";
  plus.style.top = (y - 20) + "px";
  document.getElementById("home").appendChild(plus);
  setTimeout(()=>plus.remove(),1000);
  }

  if(localStorage.getItem("setting_vibration") === "true"){
  if(navigator.vibrate){
    navigator.vibrate(20);
  }
}
  if(localStorage.getItem("setting_sound") === "true"){
  clickSound.currentTime = 0;
  clickSound.play();
}
  updateUI();

  // ===== Smart Energy System =====
  let lastTime = localStorage.getItem("lastEnergyTime");

  if(lastTime){
  let now = Date.now();
  let diff = Math.floor((now - lastTime) / 1000); // چند ثانیه گذشته
  energy = Math.min(maxEnergy, energy + diff);
}

  localStorage.setItem("lastEnergyTime", Date.now());

  setInterval(()=>{
  if(energy < maxEnergy){
    energy++;
    updateUI();
  }
  localStorage.setItem("lastEnergyTime", Date.now());
}, 1000);
}

let touchUsed = false;

coinImg.addEventListener("touchstart", (e)=>{
  e.preventDefault();
  touchUsed = true;

  for(let i=0;i<e.changedTouches.length;i++){
    const t = e.changedTouches[i];
    addCoin(t.clientX, t.clientY);
  }

  setTimeout(()=> touchUsed = false, 50);
});

coinImg.addEventListener("click", (e)=>{
  if(touchUsed) return;
  addCoin(e.clientX, e.clientY);
});

function showPage(pageId, btn){
  document.querySelectorAll(".page").forEach(p=>{
    p.classList.remove("active");
  });

  document.querySelectorAll(".navbtn").forEach(b=>{
    b.classList.remove("active");
  });

  document.getElementById(pageId).classList.add("active");
  btn.classList.add("active");
}

// ===== Settings System =====
const toggles = document.querySelectorAll(".toggle");

toggles.forEach(toggle=>{
  const key = toggle.dataset.setting;

  // بارگذاری وضعیت ذخیره‌شده
  const saved = localStorage.getItem("setting_"+key);
  if(saved === "true"){
    toggle.classList.add("active");
  }

  toggle.addEventListener("click", ()=>{
    toggle.classList.toggle("active");
    const state = toggle.classList.contains("active");
    localStorage.setItem("setting_"+key, state);
  });
});
  
</script>
</body>
</html>
